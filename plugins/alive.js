const config = require('../config');
const { cmd, commands } = require('../command');
const os = require("os");
const { runtime } = require('../lib/functions');

cmd({
    pattern: "alive",
    react: "üëã",
    desc: "Check bot online or no.",
    category: "main",
    filename: __filename
},
async (conn, mek, m, { from, quoted, body, isCmd, command, args, q, isGroup, sender, senderNumber, botNumber2, botNumber, pushname, isMe, isOwner, groupMetadata, groupName, participants, groupAdmins, isBotAdmins, isAdmins, reply }) => {
    try {
        let totalStorage = Math.floor(os.totalmem() / 1024 / 1024) + 'MB';
        let freeStorage = Math.floor(os.freemem() / 1024 / 1024) + 'MB';
        
        let desc = `üëã Hey ${pushname},

I A·¥ç A ü…™·¥†·¥á N·¥è·¥° 

…™ ·¥Ä·¥ç ·¥Ä…¥ ·¥Ä·¥ú·¥õ·¥è·¥ç·¥Ä·¥õ·¥á·¥Ö Íú± èÍú±·¥õ·¥á·¥ç ·¥° ú·¥Ä·¥õÍú±·¥Ä·¥ò·¥ò  ô·¥è·¥õ ·¥õ ú·¥Ä·¥õ ·¥Ñ·¥Ä…¥  ú·¥á ü·¥ò ·¥õ·¥è ·¥Ö·¥è Íú±·¥è·¥ç·¥á·¥õ ú…™…¥…¢, Íú±·¥á·¥Ä Ä·¥Ñ ú ·¥Ä…¥·¥Ö …¢·¥á·¥õ ·¥Ö·¥Ä·¥õ·¥Ä / …™…¥Íú∞·¥è Ä·¥ç·¥Ä·¥õ…™·¥è…¥ ·¥è…¥ ü è ·¥õ ú·¥è·¥ú…¢ ú ·¥° ú·¥Ä·¥õÍú±·¥Ä·¥ò·¥ò

>  ô·¥è·¥õ …¥·¥Ä·¥ç·¥á : ·¥Ö·¥á…¥·¥á·¥õ ú-·¥ç·¥Ö ·¥†1
> ·¥õ·¥è·¥õ·¥Ä ü  Ä·¥Ä·¥ç : ${totalStorage}
> Íú∞ Ä·¥á·¥á  Ä·¥Ä·¥ç : ${freeStorage}
> ·¥è·¥°…¥·¥á Ä : ·¥ã…™…¥…¢ X ·¥Ö·¥á…¥·¥á·¥õ ú·¥Ö·¥á·¥†¬Æ

ü•∞ ùóõùóÆùòÉùó≤ ùóÆ ùó°ùó∂ùó∞ùó≤ ùóóùóÆùòÜ ü•∞

> ·¥Ö·¥á…¥·¥á·¥õ ú-·¥ç·¥Ö  ô è ·¥ã…™…¥…¢ X ·¥Ö·¥á…¥·¥á·¥õ ú·¥Ö·¥á·¥†¬Æ`;

        const sentMsg = await conn.sendMessage(from, {
            image: { url: `https://github.com/deneth-hansaka-keerthirathna/DENETH-Media/blob/main/DENETH-MD%20V1.jpg?raw=true` },
            caption: desc,  // Send the description as the caption
            contextInfo: {
                forwardingScore: 999,
                isForwarded: true,
            }
        }, { quoted: mek });
    } catch (e) {
        console.log(e);
        reply(`${e}`);
    }
});

const axios = require('axios');

cmd({
    pattern: "vv",
    alias: ['retrive'],
    desc: "Fetch and resend a ViewOnce message content (image/video).",
    category: "misc",
    use: '<query>',
    filename: __filename
},
async (conn, mek, m, { from, reply }) => {
    try {
        const quotedMessage = m.msg.contextInfo.quotedMessage; // Get quoted message

        if (quotedMessage && quotedMessage.viewOnceMessageV2) {
            const quot = quotedMessage.viewOnceMessageV2;
            if (quot.message.imageMessage) {
                let cap = quot.message.imageMessage.caption;
                let anu = await conn.downloadAndSaveMediaMessage(quot.message.imageMessage);
                return conn.sendMessage(from, { image: { url: anu }, caption: cap }, { quoted: mek });
            }
            if (quot.message.videoMessage) {
                let cap = quot.message.videoMessage.caption;
                let anu = await conn.downloadAndSaveMediaMessage(quot.message.videoMessage);
                return conn.sendMessage(from, { video: { url: anu }, caption: cap }, { quoted: mek });
            }
            if (quot.message.audioMessage) {
                let anu = await conn.downloadAndSaveMediaMessage(quot.message.audioMessage);
                return conn.sendMessage(from, { audio: { url: anu } }, { quoted: mek });
            }
        }

        // If there is no quoted message or it's not a ViewOnce message
        if (!m.quoted) return reply("Please reply to a ViewOnce message.");
        if (m.quoted.mtype === "viewOnceMessage") {
            if (m.quoted.message.imageMessage) {
                let cap = m.quoted.message.imageMessage.caption;
                let anu = await conn.downloadAndSaveMediaMessage(m.quoted.message.imageMessage);
                return conn.sendMessage(from, { image: { url: anu }, caption: cap }, { quoted: mek });
            }
            else if (m.quoted.message.videoMessage) {
                let cap = m.quoted.message.videoMessage.caption;
                let anu = await conn.downloadAndSaveMediaMessage(m.quoted.message.videoMessage);
                return conn.sendMessage(from, { video: { url: anu }, caption: cap }, { quoted: mek });
            }
        } else if (m.quoted.message.audioMessage) {
            let anu = await conn.downloadAndSaveMediaMessage(m.quoted.message.audioMessage);
            return conn.sendMessage(from, { audio: { url: anu } }, { quoted: mek });
        } else {
            return reply("This is not a ViewOnce message.");
        }
    } catch (e) {
        console.log("Error:", e);
        reply("An error occurred while fetching the ViewOnce message.");
    }
});
